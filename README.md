# aiotsearch
Topic search with aiohttp.

#### Комментарии

Сервис реализует простой REST API для добавления тем и последующему поиску по темам 
(т.е. определению принадлежности поисковой фразы темам согласно предложенным 
в задании критериям).

Краткое описание API ниже. Примеры использования и формат запросов см. модуль `test_search.py`. 

```
@routes.post('/topics') # позволяет добавлять темы
@routes.post('/commit') # фиксирует набор тем, после фиксации добавлять темы более нельзы
@routes.get('/search') # осуществляет поиск тем для переданной фразы, набор тем должен быть предварительно зафиксирован
```

Фиксация тем используется исключительно для упрощения схемы синхронизации, т.к. это не является сутью задания.

Перед добавлением фраз в темы, а так же перед поиском фразы превращаются в множество токенов.
Доступны две стратегии токенизации `tokenize_naive` (фраза разбивается на слова, которые 
приводятся затем к нижнему регистру) и `tokenize_pymorphy` (слова дополнительно приводятся
к наиболее вероятной нормальной форме). Стратегия задается жестко в коде в модуле `search.py`. 

Для поиска используются две структуры данных - словарь тем и обратный индекс, содержащий
для каждого токена список имен тем - кандидатов, где данный токен встречается. 

```
# Dict[topic_name, List[tokenized_topic_phrase]]
self.topics: Dict[str, List[set]] = {}

# Dict[token, topic_names_set]
self.reverse_index: Dict[str, set] = {}
```

После предварительного отбора кандидатов по обратному индексу осуществляется проверка
критерия поиска для каждой из отобранных тем.

Поиск и добавление тем осуществляется в отдельных потоках. Это не приводит к ускорению
сервиса, однако позволяет не блокировать основной цикл во время долгих операций.

Проверить работу сервиса проще всего запустив тесты, согласно инструции ниже.

#### Prerequisites
```
python >= 3.6
```

#### Install
```
git clone https://github.com/AntonOvsyannikov/aiotsearch.git
cd aiotsearch/
python3 setup.py install
```

#### Uninstall 
```
python3 -m pip uninstall aiotsearch
```

#### Running
```
python3 -m aiotsearch
```

#### Running tests

```
git clone https://github.com/AntonOvsyannikov/aiotsearch.git
cd aiotsearch/
python3 -m venv venv
source venv/bin/activate
python3 -m pip install -r requirements-dev.txt
python3 -m pytest
deactivate
```


